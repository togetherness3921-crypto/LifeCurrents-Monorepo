# Agent Error Handling Protocol

When observing an error in the AI agent's behavior, the following protocol must be followed:

1.  **Prioritize Prompt-Based Correction:** Remember that the remote MCP worker auto-syncs commits to GitHub and deploys through Cloudflare; manual `wrangler deploy` runs aren’t needed unless the automation has failed. Do not introduce behavioral fallbacks—changes must deterministically address the root issue.

2.  **Rollback Erroneous Database Changes:** Do not manually "fix" incorrect data the agent has written to the database.

To modify the Supabase schema, edit the `alterCommands` array in `apply_and_verify_schema.cjs` with the required SQL DDL commands. Run the script using `node apply_and_verify_schema.cjs`. After successful execution, revert the changes to the script. This process is also used for data migrations by using SQL DML (e.g., `UPDATE`) commands.
- To modify system instructions, edit the corresponding file in the `synced_files/system_instructions/` directory. These changes are automatically synced with the Supabase database via the `auto-sync` script.
- All MCP tool responses that return a collection of graph nodes MUST structure that collection as a nested, hierarchical object reflecting the parent-child relationships, not as a flat map. The key for a node's children will be `'children'`.
- When updating system instructions, always merge new information with existing content. Do not perform destructive overwrites unless explicitly told to.